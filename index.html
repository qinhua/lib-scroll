<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<!--允许全屏-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="yes" name="apple-touch-fullscreen"/>
<meta content="telephone=no,email=no" name="format-detection"/>
<link rel="apple-touch-icon" href="favicon.png"/>
<link rel="Shortcut Icon" href="favicon.png" type="image/x-icon" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<title>lib.gesture demo</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

ul, ol {
    -webkit-margin-before: 0;
    -webkit-margin-after: 0;
    -webkit-margin-start: 0;
    -webkit-margin-end: 0;
    -webkit-padding-before: 0;
    -webkit-padding-after: 0;
    -webkit-padding-start: 0;
    -webkit-padding-end: 0;
}

body * {
    -webkit-text-size-adjust:none;
    /*-webkit-user-select: none;*/
    -webkit-tap-highlight-color: rgba(0,0,0,0);
}

body > div {
    width:100%;
    height:100%;
    overflow:hidden;
    position:absolute;
    top:0;
    left:0;
}

.viewport {
    position:relative;
    width:100%;
    height:100%;
    box-sizing:border-box;
}
</style>
</head>
<body>

<div>
    <div class="header"></div>
    <div class="viewport">
        <div class="active"></div>
        <div class="inactive"></div>
    </div>
</div>
<script src="build/combo.debug.js" type="text/javascript"></script>
<!--
<script src="../motion/build/motion.debug.js" type="text/javascript"></script>
<script src="../gesture/build/gesture.debug.js" type="text/javascript"></script>
-->
<script src="build/scroll.debug.js" type="text/javascript"></script>
<script type="text/javascript">
    (function () {
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
            return false;
        }, false);

        var viewportEl = document.querySelector('.viewport');
        var headerEl = document.querySelector('.header');
        var activeEl = document.querySelector('.viewport .active');
        var inactiveEl = document.querySelector('.viewport .inactive');
        var html1 = [], html2 = [], html3 = [];

        headerEl.style.cssText = 'overflow:hidden; height:50px; width:100%;position:relative;z-index: 2;';
        viewportEl.style.cssText = 'background-color:#000; width:100%; height:100%; box-sizing: border-box; padding-top: 50px; margin-top:-50px; overflow:hidden; display: -webkit-box;relative;z-index: 1;';
        activeEl.style.cssText = 'color:black; border:1px solid #ccc; box-sizing: border-box; width:50%; height:100%; -webkit-flex:1; overflow:hidden;'
        inactiveEl.style.cssText = 'color:white; border:1px solid #ccc; box-sizing: border-box; width:50%; height:100%; -webkit-flex:1; overflow:hidden;'

        for (var i = 0; i < 50; i++) {
            html1.push('<span style="height:25px;">' + i + '</span><br />');
        }

        for (var i = 0; i < 20; i++) {
            html2.push('<div style="height:25px;"><input type="text" value="' + i + '" /></div>');
        }

        for (var i = 0; i < 20; i++) {
            html3.push('<div style="width:40px;text-align:center;line-height:50px;padding:0 10px;"><span>' + i + '</span></div>');
        }

        activeEl.innerHTML = '<section>' + html1.join('') + '</section>';
        inactiveEl.innerHTML = '<section>' + 
                '<div style="height:50px;text-align:center;line-height:50px;" id="boundaryTop">下拉刷新</div>' + 
                html1.join('') + 
                '<div style="border:1px solid red; margin:10px auto; width:60%; height:250px; overflow:hidden;">' + 
                    '<section>' + html2.join('') + '</section>' + 
                '</div>' + 
                '<div style="height:50px;text-align:center;line-height:50px;" id="boundaryBottom">上拉加载更多</div>' + 
            '</section>';
        headerEl.innerHTML = '<section style="display:-webkit-box;height:100%;">' + html3.join('') + '</section>';

        var scrollEl1 = activeEl.querySelector('section');
        var scrollEl2 = inactiveEl.querySelector('section');
        var scrollEl3 = scrollEl2.querySelector('section');
        var scrollEl4 = headerEl.querySelector('section');

        scrollEl1.style.backgroundColor = '#CCC';
        scrollEl2.style.backgroundColor = '#999';
        scrollEl3.style.backgroundColor = '#333';
        scrollEl4.style.backgroundColor = '#FFF';

        window['scrollObj1'] = lib.scroll(scrollEl1).init();
        window['scrollObj2'] = lib.scroll(scrollEl2, {
            bounceOffset:{
                top:50, 
                bottom:50
            }
        }).init();
        window['scrollObj3'] = lib.scroll(scrollEl3, {
            paddingTop: 20, 
            paddingBottom: 50
        }).init();
        window['scrollObj4'] = lib.scroll(scrollEl4, {direction: 'x'}).init();

        scrollEl2.addEventListener('scrollstart', function() {
            console.log('scrollstart');
        }, false);

        scrollEl2.addEventListener('scrollend', function() {
            console.log('scrollend');
        }, false);

        scrollEl2.addEventListener('pullup', function(e) {
            console.log('pullup', e.boundaryOffset);
            var boundaryBottom = scrollEl2.querySelector('#boundaryBottom');
            if (e.boundaryOffset > 25 && boundaryBottom.innerHTML === '上拉加载更多') {
                boundaryBottom.innerHTML = '松开即加载';
            } else if (e.boundaryOffset <=25 && boundaryBottom.innerHTML === '松开即加载'){
                boundaryBottom.innerHTML = '上拉加载更多'
            }
        }, false);

        scrollEl2.addEventListener('pullupend', function() {
            console.log('pullupend');
            scrollObj2.disable();
            setTimeout(function() {
                scrollObj2.scrollTo(scrollObj2.getScrollHeight(), true);
                scrollObj2.enable();
            }, 2000);
        }, false);

        scrollEl2.addEventListener('pulldown', function(e) {
            console.log('pulldown', e.boundaryOffset);
            var boundaryTop = scrollEl2.querySelector('#boundaryTop');
            if (e.boundaryOffset > 25 && boundaryTop.innerHTML === '下拉刷新') {
                boundaryTop.innerHTML = '松开即刷新';
            } else if (e.boundaryOffset <= 25 && boundaryTop.innerHTML === '松开即刷新'){
                boundaryTop.innerHTML = '下拉刷新'
            }
        }, false);

        scrollEl2.addEventListener('pulldownend', function() {
            console.log('pulldownend');
            scrollObj2.disable();
            setTimeout(function() {
                scrollObj2.scrollTo(0, true);
                scrollObj2.enable();
            }, 2000);
        }, false);
    })();
</script>

</body>
</html>

